<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
<link rel="stylesheet" href="/side-menu.css">
<link rel="stylesheet" href="/syntax.css">
<link rel="stylesheet" href="/main.css">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</head>
<body>
<div id="layout">
  <a href="#menu" id="menuLink" class="menu-link">
    <!-- Hamburger icon -->
  <span></span>
  </a>
  <div id="menu">
    <div class="pure-menu custom-restricted-width custom-restricted-height">
      <a class="pure-menu-heading pure-menu-link" href="/">ALIBUILD</a>
      <ul class="pure-menu-list">
      
        <li class="pure-menu-item menu-item-section menu-item-devided">
          <a href="/quick.html" class="pure-menu-link">QUICKSTART</a>
        </li>
        
      
        <li class="pure-menu-item menu-item-section menu-item-devided">
          <a href="/user.html" class="pure-menu-link">USER MANUAL</a>
        </li>
        
      
        <li class="pure-menu-item menu-item-section menu-item-devided">
          <a href="/extra.html" class="pure-menu-link">EXTRA TOOLS</a>
        </li>
        
      
        <li class="pure-menu-item menu-item-section menu-item-devided">
          <a href="/reference.html" class="pure-menu-link">REFERENCE</a>
        </li>
        
      
      </ul>
    </div>
  </div>
  <div id="main">
    <div class="header">
      <h1>aliBuild</h1>
      <h2>Recipe reference manual</h2>
    </div>
    <div class="content">
      <h2 id="recipes-format">Recipes format</h2>

<p>The recipes are found in the a separate repository. The repository can be 
specified via the <code>-c</code> option and defaults to <em>alidist</em>.</p>

<p>The recipes themselves are called <code>&lt;package&gt;.sh</code> where <code>&lt;package&gt;</code> is the name
of the package whose build recipe is described. Please note that all recipe
filenames are lowercase: <em>e.g.</em> the recipe for <code>ROOT</code> will be in <code>root.sh</code>.</p>

<p>The recipe itself is made up of two parts: an header, and the actual build
script, separated by three dashes (<code>---</code>) standalone.</p>

<p>The header is in <a href="http://yaml.org">YAML</a> format and contains metadata about the
package, like its name, version and where to find the sources.</p>

<p>The build script is a standard build script which is invoked by the tool to
perform the build itself. A few environment variable can be expected to be
defined when the script is invoked.</p>

<p>An example recipe for <code>zlib</code> is the following:</p>

<pre><code>package: zlib
version: v1.2.8
source: https://github.com/star-externals/zlib
tag: v1.2.8
---
#!/bin/sh
./configure --prefix=$INSTALLROOT
make ${JOBS+-j $JOBS}
make install
</code></pre>

<h3 id="the-header">The header</h3>

<p>The following entries are mandatory in the header:</p>

<ul>
  <li><code>package</code>: the name of the package</li>
  <li><code>version</code>: a mnemonic for the version which will be used in the name
of the package. Notice you can actually use some special formatting
substitutions which will be replaced with the associated value on build.
Valid substitutions are:
    <ul>
      <li><code>%(commit_hash)s</code></li>
      <li><code>%(short_hash)s</code></li>
      <li><code>%(tag)s</code></li>
      <li><code>%(tag_basename)s</code></li>
      <li><code>%(year)s</code></li>
      <li><code>%(month)s</code></li>
      <li><code>%(hour)s</code></li>
    </ul>
  </li>
</ul>

<p>The following entries are optional in the header:</p>

<ul>
  <li><code>source</code>: URL of a Git repository from which the source is downloaded.
Notice it’s good practice to make sure that they are already patched, so
that you can easily point to the actual sources used by the software.</li>
  <li><code>tag</code>: tag in the above mentioned repository which points to the software
to be built.</li>
  <li><code>tag_basename</code>: if the tag resembles a path, e.g. <code>a/b/c</code>, returns the 
last part of the path, <code>c</code> in this case.</li>
  <li>
    <p><code>env</code>: dictionary whose key-value pairs are environment variables to be set,
<em>e.g.</em>:</p>

    <pre><code>env:
  "$ROOTSYS": $ROOT_ROOT
</code></pre>
  </li>
  <li>
    <p><code>prepend_path</code>: dictionary whose key-value pairs are an environment variable
name and a path to be prepended to it, as it happens in <code>LD_LIBRARY_PATH</code>.
You can append multiple paths to a single variable by specifying a list too,
<em>e.g.</em>:</p>

    <pre><code>prepend_path:
  "PATH": "$FOO_ROOT/binexec/foobar"
  "LD_LIBRARY_PATH": [ "$FOO_ROOT/sub/lib", "$FOO_ROOT/sub/lib64 ]
  "DYLD_LIBRARY_PATH":
    - "$FOO_ROOT/sub/lib"
    - "$FOO_ROOT/sub/lib64
</code></pre>

    <p>will result in prepending <code>$FOO_ROOT/binexec/foobar</code> to <code>$PATH</code>, and both
<code>$FOO_ROOT/sub/lib</code> and <code>lib64</code> to <code>LD_LIBRARY_PATH</code> and
<code>DYLD_LIBRARY_PATH</code>.</p>
  </li>
  <li><code>append_path</code>: same as <code>prepend_path</code> but paths are appended rather than
prepended.</li>
  <li>
    <p><code>requires</code>: a list of run-time and build-time dependency for the package. E.g.:</p>

    <pre><code>package: AliRoot
requires:
  - ROOT
...
</code></pre>

    <p>The specified dependencies will be built before building the given package.
You can specify platform-specific dependencies by appending <code>:&lt;regexp&gt;</code> to
the dependency name. Such a reqular expression will be matched against the
architecture provided via <code>--architecture</code> and if it does not match it will
not be included. For instance:</p>

    <pre><code>package: AliRoot-test
requires:
  - "igprof:(?!osx).*"
...
</code></pre>

    <p>will make sure that <code>IgProf</code> is only built on platforms which do not begin
by <code>osx</code>.
will make sure that IgProf is only built on architectures whose name does
not begin with <code>osx</code>.</p>
  </li>
  <li><code>build_requires</code>: currently behaves just like <code>requires</code> with the exception
that packages in this list are not included in the dependency graph
produced by alideps.</li>
  <li><code>force_rebuild</code>: set it to <code>true</code> to force re-running the build recipe.</li>
</ul>

<h3 id="the-body">The body</h3>

<p>This is the build script executed to effectively build and install your
software. Being a shell script you can be as flexible as you want in its
definition.</p>

<p>Some environment variables are made available to the script.</p>

<ul>
  <li><code>INSTALLROOT</code>: the installation prefix. This is commonly passed in the form
<code>./configure --prefix=$INSTALLROOT</code> or
<code>cmake -DCMAKE_INSTALL_PREFIX=$INSTALLROOT</code>. The build tool will create an
archive based on the sole content of this directory.</li>
  <li><code>PKGNAME</code>: name of the current package.</li>
  <li><code>PKGVERSION</code>: package version, as defined in the recipe’s <code>version:</code> field.</li>
  <li><code>PKGREVISION</code>: the “build iteration”, automatically incremented by the build
script.</li>
  <li><code>PKGHASH</code>: SHA1 checksum of the recipe.</li>
  <li><code>ARCHITECTURE</code>: an arbitrary string summarizing the current build platform.
This is passed using the <code>--architecture</code> (or <code>-a</code>) argument to the build
script.</li>
  <li><code>SOURCE0</code>: URL of the source code. Note: if <code>source:</code> is not provided in the
recipe, the variable will be empty.</li>
  <li><code>GIT_TAG</code>: the Git reference to checkout.</li>
  <li><code>JOBS</code>: number of parallel jobs to use during compilation. This is passed on
the command line to the build script, and should be used in a context like
<code>make -j$JOBS</code>.</li>
  <li><code>BUILDDIR</code>: the working directory. This is, <em>e.g.</em>, the “build directory”
for CMake, <em>i.e.</em> the directory from where you invoke <code>cmake</code>. You should not
write files outside this directory.</li>
  <li><code>BUILD_ROOT</code>: it contains <code>BUILDDIR</code> and the logfile for the build</li>
  <li><code>CONFIG_DIR</code>: directory containing all the build recipes.</li>
  <li><code>SOURCEDIR</code>: where the sources are cloned.</li>
  <li><code>REQUIRES</code>: space-separated list of all dependencies, both runtime and build
only.</li>
  <li><code>BUILD_REQUIRES</code>: space-separated list of all build dependencies, not needed
at runtime.</li>
  <li><code>RUNTIME_REQUIRES</code>: space-separated list of all runtime dependencies only.</li>
</ul>

<p>For each dependency already built, the corresponding enviornment file is loaded.
This will include, apart from custom variables and the usual <code>PATH</code> and library
paths, the following specific variables (<code>&lt;PACKAGE&gt;</code> is the package name,
uppercased):</p>

<ul>
  <li><code>&lt;PACKAGE&gt;_ROOT</code>: package installation directory.</li>
  <li><code>&lt;PACKAGE&gt;_VERSION</code>: package version.</li>
  <li><code>&lt;PACKAGE&gt;_REVISION</code>: package build number.</li>
  <li><code>&lt;PACKAGE&gt;_HASH</code>: hash of the recipe used to build the package.</li>
</ul>


    </div>
  </div>
</div>
<script src="/ui.js"></script>
</body>
</html>
